# Agent Logs

- 2026-02-22 22:15
  - 重點: TUI 終端視覺化、安全避開隱藏目錄、不落地 `--out-dir` 參數導入
  - 影響:
    - `pyproject.toml` 加入了 `rich` 依賴。
    - `utils.py` 進行了 UI 翻新，移除會破壞版面的 `print` 與 `logger`，全部改交由 `rich.progress` 與 `rich.table` 繪製動態進度條及空間報表；
    - 修改 `collect_files` 函式，自動過濾掉任何以 `.` 或 `__` 開頭之隱藏或專案配置目錄。
    - `compress_images.py` 與 `images_to_webp.py` 新增 `-O / --out-dir` 選項，容許使用者將壓縮過的檔案完整鏡像（包含同等樹狀目錄）輸往另一個實體路徑避免原資料夾污染。並新增了美觀的起始歡迎面板 (`Panel`)。
  - 結果: 大幅改善使用者體驗（UX）；進度條讓時間預估更為直觀，且新增之 `--out-dir` 徹底解決了備份檔案雜亂無章的痛點。
  - 更新者: Antigravity Agent
- 2026-02-22 21:55
  - 重點: 實作 7 項優化 (ProcessPoolExecutor, lossless, exif, max-depth, logging, ... )
  - 影響:
    - 修改 `utils.py`: 升級 `run_pipeline` 改用 `ProcessPoolExecutor` 加速 CPU 運算；加入 `setup_logger` 使用 `logging` 取代 `print`；在 `collect_files` 加入深度參數 `-d/--max-depth` 支援。
    - 修改 `compress_images.py`: 加入 BMP 跳過機制；加入 `-d` 參數綁定；更新為 Python logging 機制。升級至 v4.0。
    - 修改 `images_to_webp.py`: 加入 `-l/--lossless` 與 `-e/--keep-exif` 參數，強化 WebP 轉換。升級至 v3.0。
    - 加入了基本的單元測試 `tests/test_utils.py`
  - 結果: 執行速度因多行程可平行化而變得更快；支援深入子目錄控制；支援無損 WebP 轉換；更好的 logging 格式化。
  - 更新者: Antigravity Agent
- 2026-02-22 21:47
  - 重點: 架構重構 — 抽共用模組 `utils.py`、消滅全域 mutable state
  - 影響:
    - 新增 `utils.py`: 包含 `FileResult` dataclass、`ProcessingSummary`、`run_pipeline()` 並行管線、`collect_files()`、`print_summary()`、`create_base_parser()`、`resolve_directory()`、`validate_quality()` 等共用邏輯
    - 重構 `compress_images.py`: 移除全域 `stats`/`stats_lock`，`compress_image()` 改回傳 `FileResult`，使用 `functools.partial` 綁定參數後交由 `run_pipeline()` 執行。版本升至 v3.0
    - 重構 `images_to_webp.py`: 同上重構模式，版本升至 v2.0
    - 更新 `README.md`: 新增架構設計圖、更新專案結構說明
  - 結果: 兩個工具不再有任何全域 mutable state (stats, stats_lock)，消除 thread-safety 隱患。重複邏輯 (argparse setup, stats counting, directory walking, print summary) 全部集中到 `utils.py`，各工具檔只保留業務邏輯 (compress_image / convert_to_webp) 和 CLI 入口。
  - 更新者: Antigravity Agent

- 2026-02-22 21:42
  - 重點: 修復 bug、移除冗餘 import、新增 dry-run 模式與空間節省統計
  - 影響:
    - 修改 `compress_images.py`: 修復 hardcoded `_70%` bug，改用 regex `_\d+%` 通用匹配；移除未使用的 `import os`；新增 `--dry-run` 預覽模式；新增總空間節省統計 (原始/壓縮後/節省百分比)；版本升至 v2.1
    - 修改 `images_to_webp.py`: 移除未使用的 `import os`；新增 `--dry-run` 預覽模式；新增總空間節省統計；版本升至 v1.1
    - 更新 `README.md`: 補充 dry-run 與空間統計說明、新增輸出範例區塊
  - 結果: 兩個工具現在都支援預覽模式，使用者可以在不實際壓縮/轉檔的情況下預覽影響範圍；完成後會顯示詳細的空間節省報告。壓縮檔名偵測不再 hardcode `_70%`，改為通用 regex 匹配。
  - 更新者: Antigravity Agent

- 2026-02-17 17:59
  - 重點: 新增 `images_to_webp.py` 腳本，支援圖片轉 WebP 並保持目錄結構。
  - 影響: 
    - 新增 `d:\googledrive\MyData\antigravity_workspace\工具-壓圖70\images_to_webp.py`
    - 修改 `pyproject.toml` 加入 `images-to-webp` 指令
    - 更新 `README.md` 說明文件
  - 結果: 使用者現在可以使用 `uv run images-to-webp` 將目錄下的圖片批量轉換為 WebP 格式，並會自動建立 `webpimage` 目錄存放結果。
  - 更新者: Antigravity Agent
